$(function(){var o=$("#map"),a=$("#svg"),c=$("#inner"),n=a[0].viewBox.baseVal,r=n.width,l=n.height,u=1,s={x:0,y:0},h=!1,x={x:0,y:0},m=new Map,y=null,f=null;function v(n,t,e){return Math.max(t,Math.min(e,n))}function d(){return Math.max(o.width()/r,o.height()/l)}function g(n,t){n&&"touch"!==(1<arguments.length&&void 0!==t?t:"mouse")?c.css("transition","transform 0.2s ease-out"):c.css("transition","none")}function p(){var n=o.width(),t=o.height(),e=r*u,i=l*u,n=Math.min(0,n-e),e=Math.min(0,t-i);s.x=v(s.x,n,0),s.y=v(s.y,e,0),c.css("transform","translate(".concat(s.x,"px, ").concat(s.y,"px) scale(").concat(u,")"))}function t(){var n=o.width(),t=o.height(),e=(u=Math.max(n/r,t/l),r*u),i=l*u;s.x=(n-e)/2,s.y=(t-i)/2,p()}function M(n,t){var e=t.clientX-n.clientX;return Math.hypot(e,t.clientY-n.clientY)}function w(n,t){return{x:(n.clientX+t.clientX)/2,y:(n.clientY+t.clientY)/2}}a.on("pointerdown",function(n){a.css("touch-action","none"),m.set(n.pointerId,n),1===m.size?(x={x:n.clientX-s.x,y:n.clientY-s.y},h=!0,a.css("cursor","grabbing")):2===m.size&&(n=Array.from(m.values()),y=M(n[0],n[1]),f=w(n[0],n[1]),g(!1,"touch"))}),a.on("pointermove",function(n){var t,e,i,o;m.has(n.pointerId)&&(m.set(n.pointerId,n),1===m.size&&h?(n=Array.from(m.values())[0],g(!(s={x:n.clientX-x.x,y:n.clientY-x.y}),"touch"),p()):2===m.size&&(t=M((n=Array.from(m.values()))[0],n[1]),n=w(n[0],n[1]),y&&f&&(e=u,u*=t/y,u=Math.max(u,d()),u=Math.min(u,5),i=n.x-s.x,o=n.y-s.y,s.x-=i*(u/e-1),s.y-=o*(u/e-1),g(!1,"touch"),p()),y=t,f=n))}),a.on("pointerup pointercancel",function(n){m.delete(n.pointerId),2===m.size?(n=Array.from(m.values()),y=M(n[0],n[1]),f=w(n[0],n[1])):1===m.size?(n=Array.from(m.values())[0],x={x:n.clientX-s.x,y:n.clientY-s.y},h=!(f=y=null)):(h=!1,f=y=null,a.css("cursor","grab"))}),a.on("wheel",function(n){n.preventDefault(),g(!0,"mouse");var t=u,e=(u+=5e-4*-n.originalEvent.deltaY,u=Math.max(u,d()),u=Math.min(u,5),a[0].getBoundingClientRect()),i=n.clientX-e.left-s.x,n=n.clientY-e.top-s.y;s.x-=i*(u/t-1),s.y-=n*(u/t-1),p()}),$("#zoom-in").on("click",function(){var n=u,t=(u*=1.2,u=Math.max(u,d()),u=Math.min(u,5),o[0].getBoundingClientRect()),e=t.width/2,t=t.height/2,i=(e-s.x)/n,n=(t-s.y)/n;s.x=e-i*u,s.y=t-n*u,g(!0,"mouse"),p()}),$("#zoom-out").on("click",function(){var n=u,t=(u/=1.2,u=Math.max(u,d()),u=Math.min(u,5),o[0].getBoundingClientRect()),e=t.width/2,t=t.height/2,i=(e-s.x)/n,n=(t-s.y)/n;s.x=e-i*u,s.y=t-n*u,g(!0,"mouse"),p()}),$("#reset").on("click",function(){t()}),$(window).on("resize",t),t()});